(function(){function e(a){return void 0==a||null==a?!0:!1}function f(){this.length=16;this.timestamp=+new Date;this.generate=function(){for(var a=this.timestamp.toString().split("").reverse(),d="",b=0;b<this.length;++b){var c;c=a.length-1;c=Math.floor(Math.random()*(c-0+1))+0;d+=a[c]}return d}}$$ivideoConf={instances:{},eventListenerCreated:!1};this.IVideo=function(a,d){this.options=d;if(e(a)||null==d)return this;this.setDefaults();this.element=document.querySelector(a);var b=this;if(!$$ivideoConf.eventListenerCreated){$$ivideoConf.eventListenerCreated=
!0;var c=window.addEventListener?"addEventListener":"attachEvent";(0,window[c])("attachEvent"==c?"onmessage":"message",function(a){if("ivideoapi://"==a.data.substring(0,12)){a=JSON.parse(a.data.split("ivideoapi://")[1]);var c=a.instance;delete a.instance;var e=Object.getOwnPropertyNames(a)[0];null!=c&&(b=$$ivideoConf.instances[c]);switch(e){case "volume":b._volume=a.volume;break;case "video":b._video=a.video;break;case "currentTime":b._currentTime=a.currentTime;break;case "subtitles":b._subtitles=
a.subtitles;break;case "paused":b._paused=a.paused;break;case "watchTime":b._watchTime=a.watchTime;break;case "data":b._sceneData=a.data;b.name=b._sceneData.name;break;case "contextChanged":b._context=a.contextChanged;break;case "event":if("play"==a.event)b.options.onplay();else if("pause"==a.event)b.options.onpause();else if("ended"==a.event)b.options.onend();else if("timeupdate"==a.event)b.options.onprogress();else if("onunload"==a.event)b.options.onunload();else if("onbeforeunload"==a.event)b.options.onbeforeunload();
else if("canplay"==a.event)d.connectSharesWithParent&&(a={name:"parentPlayerUrl",value:window.location.href},b.sendMessage(a)),b.options.onready();else if("customcallback"==a.event)b.options.oncustomcallback(a.params)}}},!1)}this.init();this.sendMessage({name:"externalVideoUrl",value:d.externalVideoUrl})};this.IVideo.prototype.init=function(){this.createIframe()};this.IVideo.prototype.setDefaults=function(){void 0==this.options.host&&(this.options.host="https://ivideo.streamx.io");void 0==this.options.width&&
(this.options.width="854px");void 0==this.options.height&&(this.options.height="480px");"function"!==typeof this.options.onready&&(this.options.onready=function(){});"function"!==typeof this.options.onplay&&(this.options.onplay=function(){});"function"!==typeof this.options.onpause&&(this.options.onpause=function(){});"function"!==typeof this.options.onprogress&&(this.options.onprogress=function(){});"function"!==typeof this.options.onend&&(this.options.onend=function(){});"function"!==typeof this.options.onunload&&
(this.options.onunload=function(){});"function"!==typeof this.options.onbeforeunload&&(this.options.onbeforeunload=function(){});"function"!==typeof this.options.oncustomcallback&&(this.options.oncustomcallback=function(){})};this.IVideo.prototype.createIframe=function(a){var d=new f;a=document.createElement("iframe");d="ivideo-"+d.generate();a.setAttribute("id",d);a.setAttribute("name",d);a.setAttribute("allow","autoplay; fullscreen; microphone; camera");$$ivideoConf.instances[d]=this;this.iframeId=
d;var b="watch";"RAW_VIDEO"==this.options.type&&(b="watchv");b=this.options.host+"/"+b;b=null!=this.options.id?b+("?iv\x3d"+this.options.id):b+"?external\x3d1";if(null!=this.options.autoplay){var c=1;this.options.autoplay?c=1:c=0;b+="\x26autoplay\x3d"+c}null!=this.options.raw&&(c=1,this.options.raw?c=1:c=0,b+="\x26raw\x3d"+c);null!=this.options.subtitles&&(b+="\x26sub\x3d"+this.options.subtitles);null!=this.options.externalVideoUrl&&(b+="\x26externalVideoUrl\x3d"+encodeURIComponent(this.options.externalVideoUrl));
null!=this.options.authToken&&(b+="\x26token\x3d"+this.options.authToken);null!=this.options.externalUser&&(c=encodeURIComponent(JSON.stringify(this.options.externalUser)),b+="\x26externalUser\x3d"+c);null!=this.options.campaignParams&&(b+="\x26"+this.options.campaignParams);null!=this.options.time&&(b+="\x26t\x3d"+this.options.time);a.setAttribute("src",b);a.setAttribute("width",this.options.width);a.setAttribute("height",this.options.height);a.setAttribute("position","inherit");a.setAttribute("frameborder",
"0");a.setAttribute("webkitallowfullscreen","");a.setAttribute("mozallowfullscreen","");a.setAttribute("allowfullscreen","");a.setAttribute("allow","autoplay; fullscreen; microphone; camera");this.element.appendChild(a);this.iframeReceiver=document.getElementById(d).contentWindow};this.IVideo.prototype.play=function(){return this.sendMessage({name:"play"})};this.IVideo.prototype.pause=function(){return this.sendMessage({name:"pause"})};this.IVideo.prototype.duration=function(){return e(this._sceneData)||
e(this._sceneData.mediaContent)?null:this._sceneData.mediaContent.duration};this.IVideo.prototype.watchTime=function(){return void 0==this._watchTime?0:this._watchTime};this.IVideo.prototype.paused=function(){return this._paused};this.IVideo.prototype.volume=function(a){if(null==a)return this._volume;this.sendMessage({name:"setVolume",value:a})};this.IVideo.prototype.updateSkinProperty=function(a,d){this.sendMessage({name:"updateSkinProperty",value:{name:a,value:d}})};this.IVideo.prototype.video=
function(){return this._video};this.IVideo.prototype.currentTime=function(a){if(null==a)return this._currentTime;this.sendMessage({name:"setCurrentTime",value:a})};this.IVideo.prototype.subtitles=function(a){if(null==a)return this._subtitles;this.sendMessage({name:"setSubtitles",value:a})};this.IVideo.prototype.removeSubtitles=function(){this.sendMessage({name:"setSubtitles",value:null})};this.IVideo.prototype.sendMessage=function(a){this.iframeReceiver.postMessage("ivideo://"+JSON.stringify(a),"*")};
this.IVideo.prototype.getContext=function(){return this._context};return IVideo})();